<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Monday, November 16, 2020, 11:18 PM -->
<!-- MuClient version 5.07-pre -->

<!-- Plugin "Tallimos_StatDisruptor" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Tallimos_StatDisruptor"
   author="Tallimos"
   id="528d70104de5ca0ab6b13d38"
   language="Lua"
   purpose="Allows the user to fine tune their spellup"
   save_state="y"
   date_written="2020-11-16 23:17:38"
   requires="4.30"
   version="1.0"
   >
</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->

-- mental balance no lucky casts
-- combat mind is random


<triggers>
	<trigger
		group="Disrupt"
		name="LostConcentration"
		script="LostConcentration"
		match="^You lost your concentration while trying to cast disrupt\.$"
		regexp="y"
		sequence="100"
		omit_from_output="n"
		>
	</trigger>
	<trigger
		group="DisruptEnable"
		name="DisruptSucceed"
		script="Disrupted"
		match="^You disrupt the magic in your (.*?) spell\.$"
		regexp="y"
		sequence="100"
		omit_from_output="n"
		>
	</trigger>
	<trigger
		group="DisruptEnable"
		name="DisruptFail"
		script="ReDisrupt"
		match="^You need to be more disruptive\. The (.*?) is still there\!$"
		regexp="y"
		sequence="100"
		omit_from_output="n"
		>
	</trigger>
	<trigger
		group="Disrupt"
		name="OtherStat"
		script="StatCheck"
		match="^\s+\: (.*?) (?:\-|\+)(\d+)\s+\((.*?)\)$"
		regexp="y"
		sequence="100"
		omit_from_output="n"
		>
	</trigger>
	<trigger
		group="Disrupt"
		name="ResistanceLine"
		script="CheckResistance"
		match="^\s+\: resistance to (.*?) (?:\-|\+)(\d+)\s+\((.*?)\)$"
		regexp="y"
		sequence="90"
		omit_from_output="n"
		>
	</trigger>
	<trigger
		group="Disrupt"
		name="ResistanceLineName"
		script="CheckResistanceName"
		match="^\s+(.*?)\s+\: resistance to (.*?) (?:\-|\+)(\d+)\s+\((.*?)\)$"
		regexp="y"
		sequence="90"
		omit_from_output="n"
		>
	</trigger>
	<trigger
		group="Disrupt"
		name="NameLine"
		script="StatCheckName"
		match="^\s+(.*?)\s+\: (.*?) (?:\-|\+)(\d+)\s+\((.*?)\)$"
		regexp="y"
		sequence="110"
		omit_from_output="n"
		>
	</trigger>
	<trigger
		group="Disrupt"
		script="EndofList"
		match="^Use \'saffects\' to see a short version of your affects\.$"
		regexp="y"
		sequence="100"
		omit_from_output="n"
		>
	</trigger>
	<trigger
		group="Disrupt"
		name="notaffected"
		script="NotAffected"
		match="^You are not affected by any skills or spells\.$"
		regexp="y"
		sequence="100"
		omit_from_output="n"
		>
	</trigger>
	<trigger
		group="Disrupt"
		match="You are affected by the following skills/spells\:$"
		regexp="y"
		sequence="100"
		omit_from_output="n"
		>
	</trigger>
	<trigger
		group="Disrupt"
		match="You are affected by (\d+) skills and (\d+) spell\.$"
		regexp="y"
		sequence="100"
		omit_from_output="n"
		>
	</trigger>
</triggers>

<!--  Aliases  -->

<aliases>
	<alias
		script="StatDisruptor"
		match="^(?:statdis|sdis) (.*?) (str|int|wis|con|dex|luck|hit roll|damage roll|hr|dr) (\d+)$"
		expand_variables="y"
		regexp="y"
		sequence="100"
		enabled="y"
		>
	</alias>
	<alias
		script="ResistDisruptor"
		match="^(?:resdis|rdis) (.*?) (Bash|Pierce|Slash|Acid|Air|Cold|Disease|Earth|Electric|Energy|Fire|Holy|Light|Magic|Mental|Negative|Poison|Shadow|Sonic|Water|all physical|all magic) (\d+)$"
		expand_variables="y"
		regexp="y"
		sequence="100"
		enabled="y"
		>
	</alias>
	<alias
		script="DisruptAbort"
		match="^(?:statdis|sdis) abort$"
		expand_variables="y"
		regexp="y"
		sequence="100"
		enabled="y"
		>
	</alias>
	<alias
		script="sdis_help"
		match="^(?:statdis|sdis) help$"
		expand_variables="y"
		regexp="y"
		sequence="100"
		enabled="y"
		>
	</alias>
</aliases>


<!--  Script  -->

<script>

<![CDATA[
require "aard_register_z_on_create"

require "themed_miniwindows"

require "tprint"
require "mw_theme_base"
require "serialize"
require "commas"
require "gmcphelper"
require "copytable"
require "aardmapper"
require "aard_lua_extras"
require "wait"

----------------------------START OF VARIABLE DECLARATIONS----------------------------

local msg_colour      = "darkslategrey"
local err_colour      = "firebrick"
local help_colour     = "royalblue"
local qty_colour      = "yellow"
local optional_colour = "lightcoral"
local command_colour  = "white"
local cmd_required    = "royalblue"
local help_command_colour  = "red"

local line = "=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-="

local statname = ""
local statcheck = "NO"
local statamt = 0
local fullname = ""
local disruptamt = 0
local tocast = ""

function Disrupted(name, line, wc)

	if wc[1] == fullname then
	
		EnableTrigger ("notaffected", 0)
		
		Send ("cast '" .. fullname .. "'")
		Send ("affect '" .. fullname .. "'")
		
	end
	
end

function LostConcentration()

	Send ("c disrupt '" .. fullname .. "'")
	
end

function ReDisrupt(name, line, wc)

	if wc[1] == fullname then
		Send ("c disrupt '" .. fullname .. "'")
	end

end

function ResistDisruptor(name, line, wc)

	tocast = wc[1]
	statname = wc[2]
	statamt = tonumber(wc[3]) + 1
	disruptcheck = "NO"
	statcheck = "NO"
	
	if statamt > 25 then
		ColourNote(qty_colour, "", statamt, msg_colour, "", " seems a little high and may send you into an infinte loop")
	else
		resistcheck = "YES"	
		world.EnableGroup ("Disrupt", 1)
		Send ("affect '" .. tocast .. "'")
	end
end

function CheckResistanceName(name, line, wc)
	
	if resistcheck == "YES" then
	
		fullname = string.lower(wc[1])
		
		local rname = wc[2]
		local ramt = tonumber(wc[3])
		
		EnableTrigger ("notaffected", 1)
		
		if rname == statname then
			if ramt > statamt then
				disruptcheck = "NO"
				ColourNote(qty_colour, "", tocast, msg_colour, "", " already has ", qty_colour, "", statamt, msg_colour, "", " or more ", qty_colour, "", statname)
			else
				if disruptamt > 6 then
					disruptcheck = "NO"
					ColourNote(msg_colour, "", "Auto disrupt disabled at 6 failed attempts")
				else
					statcheck = "YES"
					Send ("c disrupt '" .. fullname .. "'")
					world.EnableGroup ("DisruptEnable", 1)	
					disruptamt = disruptamt + 1
				end
			end
		end
	end
end

function CheckResistance(name, line, wc)

	if resistcheck == "YES" then
	
		local rname = wc[2]
		local ramt = tonumber(wc[3])
		
		EnableTrigger ("notaffected", 1)
		
		if rname == statname then
			if ramt > statamt then
				disruptcheck = "NO"
				ColourNote(qty_colour, "", tocast, msg_colour, "", " already has ", qty_colour, "", statamt, msg_colour, "", " or more ", qty_colour, "", statname)
			else
				if disruptamt > 6 then
					disruptcheck = "NO"
					ColourNote(msg_colour, "", "Auto disrupt disabled at 6 failed attempts")
				else
					statcheck = "YES"
					Send ("c disrupt '" .. fullname .. "'")
					world.EnableGroup ("DisruptEnable", 1)	
					disruptamt = disruptamt + 1
				end
			end
		end
	end
end

function StatCheckName(name, line, wc)
	
	fullname = string.lower(wc[1])
	
	local sname = wc[2]
	local samt = tonumber(wc[3])
	
	EnableTrigger ("notaffected", 1)
	
	if sname == statname then
		if samt > statamt then
			disruptcheck = "NO"
			ColourNote(qty_colour, "", tocast, msg_colour, "", " already has ", qty_colour, "", statamt, msg_colour, "", " or more ", qty_colour, "", statname)
		else
			if disruptamt > 6 then
				disruptcheck = "NO"
				ColourNote(msg_colour, "", "Auto disrupt disabled at 6 failed attempts")
			else
				statcheck = "YES"
				Send ("c disrupt '" .. fullname .. "'")
				world.EnableGroup ("DisruptEnable", 1)	
				disruptamt = disruptamt + 1
			end
		end
	end
end

function StatCheck(name, line, wc)

	local sname = wc[1]
	local samt = tonumber(wc[2])
	
	EnableTrigger ("notaffected", 1)
	
	if sname == statname then
		if samt > statamt then
			disruptcheck = "NO"
			ColourNote(qty_colour, "", tocast, msg_colour, "", " already has ", qty_colour, "", statamt, msg_colour, "", " or more ", qty_colour, "", statname)
		else			
			if disruptamt > 5 then
				disruptcheck = "NO"
				ColourNote(msg_colour, "", "Auto disrupt disabled after 6 failed attempts")
			else
				disruptcheck = "YES"
				statcheck = "YES"
				Send ("c disrupt '" .. fullname .. "'")
				world.EnableGroup ("DisruptEnable", 1)	
				disruptamt = disruptamt + 1
			end
		end
	end
end

function EndofList()

	if disruptcheck == "YES" then 
	else
	
		world.EnableGroup ("Disrupt", 0)

	end
	
	if statcheck == "NO" then 
		ColourNote(qty_colour, "", fullname, msg_colour, "", " did not have ", qty_colour, "", statname)
	end
	
end

function NotAffected()

	ColourNote(err_colour, "", "You are not affected by ", qty_colour, "", tocast, err_colour, "", ".")
	statcheck = "YES"
	
end

function StatDisruptor(name, line, wc)

	tocast = wc[1]
	statname = wc[2]
	statamt = tonumber(wc[3]) + 1
	disruptcheck = "NO"
	statcheck = "NO"
	resistcheck = "NO"
	
	if statname == "hr" then
		statname = "hit roll"
		if statamt > 60 then
			ColourNote(qty_colour, "", statamt, msg_colour, "", " seems a little high for ", qty_colour, "", statname, msg_colour, "", " and may send you into an infinte loop")
		else
			world.EnableGroup ("Disrupt", 1)	
			Send ("affect '" .. tocast .. "'")
		end
	end
	
	if statname == "dr" then
		statname = "damage roll"
		if statamt > 60 then
			ColourNote(qty_colour, "", statamt, msg_colour, "", " seems a little high for ", qty_colour, "", statname, msg_colour, "", " and may send you into an infinte loop")
		else
			world.EnableGroup ("Disrupt", 1)	
			Send ("affect '" .. tocast .. "'")
		end
	end

	if statname == "str" or statname == "int" or statname == "wis" or statname == "con" or statname == "dex" or statname == "luck" then
		if statamt > 25 then
			ColourNote(qty_colour, "", statamt, msg_colour, "", " seems a little high for ", qty_colour, "", statname, msg_colour, "", " and may send you into an infinte loop")
		else
			world.EnableGroup ("Disrupt", 1)	
			Send ("affect '" .. tocast .. "'")
		end
	end
end

function DisruptAbort()

	world.EnableGroup ("DisruptEnable", 0)	
	world.EnableGroup ("Disrupt", 0)
	ColourNote(msg_colour, "", "Aborting Disruptor")
	
end

function sdis_help()
	
	local title = "Tallimos' Stat Disruptor - Help"
	local title2 = "=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-="
	
	local leng = tonumber(string.len(title))
	local leng2 = tonumber(string.len(title2))
	
	local spacing = 0
	local lendif = 0
	
	if leng > leng2 then
	else
		lendif = leng2 - leng
		lendif = lendif * 0.5
	end

	spacing = string.rep(" ", lendif)
	
	ColourNote(help_colour, "", spacing, help_command_colour, "", "Tallimos' Stat Disruptor - Help")
	ColourNote(help_colour, "", "=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=")
	ColourNote(help_colour, "", "Plugin tht gives the user the ability to try for a better cast with their spells.")
	ColourNote(help_colour, "", "The user can input how much of a certain stat they want the particular spell to")
	ColourNote(help_colour, "", "have and the script will keep disrupting and casting until the amount they have")
	ColourNote(help_colour, "", "entered is reached or surpassed.")
	ColourNote(help_colour, "", "=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=")
	Note("")
	
	ColourNote(help_command_colour, "", "statdis <spell name> <stat> <stat amount>", help_colour, "", " - command to start the stat check process")
	ColourNote(help_command_colour, "", "                                            <stat>", help_colour, "", " can be ", qty_colour, "", "str", help_colour, "", ", ", qty_colour, "", "int", help_colour, "", ", ", qty_colour, "", "wis", help_colour, "", ", ", qty_colour, "", "con", help_colour, "", ", ", qty_colour, "", "dex", help_colour, "", ", ")
	ColourNote(qty_colour, "", "                                            luck", help_colour, "", ", ", qty_colour, "", "hit roll", help_colour, "", " and ", qty_colour, "", "damage roll")
	ColourNote(qty_colour, "", "                                            hr", help_colour, "", " and ", qty_colour, "", "dr", help_colour, "", " can also be used")
	Note("")

	ColourNote(help_command_colour, "", "resdis <spell name> <resist> <resist amount>", help_colour, "", " - command to start the stat check")
	ColourNote(help_colour, "", "                                               process ", help_command_colour, "", "<resist>", help_colour, "", " can be ", 		qty_colour, "", "bash", help_colour, "", ", ", qty_colour, "", "pierce", help_colour, "", ", ")
	ColourNote(qty_colour, "", "                                               slash", help_colour, "", ", ", qty_colour, "", "acid", help_colour, "", ", ", qty_colour, "", "air", help_colour, "", ", ", qty_colour, "", "cold", help_colour, "", ", ", qty_colour, "", "disease", help_colour, "", ", ")
	ColourNote(qty_colour, "", "                                               earth", help_colour, "", ", ", qty_colour, "", "electric", help_colour, "", ", ", qty_colour, "", "energy", help_colour, "", ", ", qty_colour, "", "fire", help_colour, "", ", ", qty_colour, "", "holy", help_colour, "", ", ")
	ColourNote(qty_colour, "", "                                               light", help_colour, "", ", ", qty_colour, "", "magic", help_colour, "", ", ", qty_colour, "", "mental", help_colour, "", ", ", qty_colour, "", "negative", help_colour, "", ", ")
	ColourNote(qty_colour, "", "                                               poison", help_colour, "", ", ", qty_colour, "", "shadow", help_colour, "", ", ", qty_colour, "", "sonic", help_colour, "", ", ", qty_colour, "", "water", help_colour, "", ", ")
	ColourNote(qty_colour, "", "                                               all physical", help_colour, "", " and ", qty_colour, "", "all magic")
	Note("")
	
	ColourNote(help_command_colour, "", "statdis abort", help_colour, "", " - command to stop the system in case an infinite loop happens")
	Note("")
	
	ColourNote(help_colour, "", "=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=")
	Note("")

end	-- sdis_help

function OnPluginInstall ()
	
	ColourNote(help_colour, "", "Thank you for installing Tallimos' Stat Disruptor. Please see ", help_command_colour, "", "sdis help", help_colour, "", " for more information.")

end
]]>
</script>
</muclient>
